{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Detailed Balance Sheet Report</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .level-1 { margin-left: 0px; font-weight: bold; }
        .level-2 { margin-left: 20px; font-weight: 600; }
        .level-3 { margin-left: 40px; font-weight: 500; }
        .level-4 { margin-left: 60px; font-weight: normal; font-size: 0.9em; }
        .total-line { border-top: 1px solid #ccc; margin-top: 5px; padding-top: 5px; }
    </style>
</head>
<body class="bg-light">
<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header text-center">
                    <h3>Detailed Balance Sheet Report</h3>
                    <p class="mb-0">As of {{ report_date }}</p>
                </div>
                <div class="card-body">
                    
                    <div class="row">
                        <!-- Assets Section -->
                        <div class="col-md-6">
                            <h4 class="text-primary mb-3">ASSETS</h4>
                            
                            {% for asset_group in assets_data %}
                            <div class="mb-4">
                                <!-- Account Group Level -->
                                <div class="level-1 text-primary">
                                    {{ asset_group.name }}
                                </div>
                                
                                {% for account in asset_group.accounts %}
                                <!-- Account Level -->
                                <div class="level-2 text-dark">
                                    {{ account.name }}
                                </div>
                                
                                {% for subaccount in account.subaccounts %}
                                <!-- SubAccount Level -->
                                <div class="level-3 text-secondary">
                                    {{ subaccount.name }}
                                </div>
                                
                                {% for curr_attr in subaccount.currency_attributes %}
                                <!-- Currency-Attribute Level -->
                                <div class="level-4 d-flex justify-content-between">
                                    <span>{{ curr_attr.currency }} - {{ curr_attr.attribute }}</span>
                                    <span>${{ curr_attr.balance|floatformat:2 }}</span>
                                </div>
                                {% endfor %}
                                
                                <!-- SubAccount Total -->
                                <div class="level-3 d-flex justify-content-between total-line">
                                    <strong>SubAccount Total:</strong>
                                    <strong>${{ subaccount.total|floatformat:2 }}</strong>
                                </div>
                                {% endfor %}
                                
                                <!-- Account Total -->
                                <div class="level-2 d-flex justify-content-between total-line text-dark">
                                    <strong>Account Total:</strong>
                                    <strong>${{ account.total|floatformat:2 }}</strong>
                                </div>
                                {% endfor %}
                                
                                <!-- Account Group Total -->
                                <div class="level-1 d-flex justify-content-between total-line text-primary">
                                    <strong>{{ asset_group.name }} Total:</strong>
                                    <strong>${{ asset_group.total|floatformat:2 }}</strong>
                                </div>
                            </div>
                            {% endfor %}
                            
                            <!-- Total Assets -->
                            <div class="level-1 d-flex justify-content-between border-top border-2 pt-2 text-primary">
                                <h5>TOTAL ASSETS:</h5>
                                <h5>${{ total_assets|floatformat:2 }}</h5>
                            </div>
                        </div>
                        
                        <!-- Liabilities Section -->
                        <div class="col-md-6">
                            <h4 class="text-danger mb-3">LIABILITIES</h4>
                            
                            {% for liability_group in liabilities_data %}
                            <div class="mb-4">
                                <!-- Account Group Level -->
                                <div class="level-1 text-danger">
                                    {{ liability_group.name }}
                                </div>
                                
                                {% for account in liability_group.accounts %}
                                <!-- Account Level -->
                                <div class="level-2 text-dark">
                                    {{ account.name }}
                                </div>
                                
                                {% for subaccount in account.subaccounts %}
                                <!-- SubAccount Level -->
                                <div class="level-3 text-secondary">
                                    {{ subaccount.name }}
                                </div>
                                
                                {% for curr_attr in subaccount.currency_attributes %}
                                <!-- Currency-Attribute Level -->
                                <div class="level-4 d-flex justify-content-between">
                                    <span>{{ curr_attr.currency }} - {{ curr_attr.attribute }}</span>
                                    <span>${{ curr_attr.balance|floatformat:2 }}</span>
                                </div>
                                {% endfor %}
                                
                                <!-- SubAccount Total -->
                                <div class="level-3 d-flex justify-content-between total-line">
                                    <strong>SubAccount Total:</strong>
                                    <strong>${{ subaccount.total|floatformat:2 }}</strong>
                                </div>
                                {% endfor %}
                                
                                <!-- Account Total -->
                                <div class="level-2 d-flex justify-content-between total-line text-dark">
                                    <strong>Account Total:</strong>
                                    <strong>${{ account.total|floatformat:2 }}</strong>
                                </div>
                                {% endfor %}
                                
                                <!-- Account Group Total -->
                                <div class="level-1 d-flex justify-content-between total-line text-danger">
                                    <strong>{{ liability_group.name }} Total:</strong>
                                    <strong>${{ liability_group.total|floatformat:2 }}</strong>
                                </div>
                            </div>
                            {% endfor %}
                            
                            <!-- Total Liabilities -->
                            <div class="level-1 d-flex justify-content-between border-top border-2 pt-2 text-danger">
                                <h5>TOTAL LIABILITIES:</h5>
                                <h5>${{ total_liabilities|floatformat:2 }}</h5>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Balance Check -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <strong>Balance Check:</strong> 
                                Assets (${{ total_assets|floatformat:2 }}) 
                                {% if total_assets == total_liabilities %}
                                    = Liabilities (${{ total_liabilities|floatformat:2 }}) ✅
                                {% else %}
                                    ≠ Liabilities (${{ total_liabilities|floatformat:2 }}) ⚠️
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="card-footer text-center">
                    <a href="{% url 'home' %}" class="btn btn-secondary">Back to Home</a>
                    <button onclick="window.print()" class="btn btn-primary">Print Report</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
